language: python

python:
  - "3.8"
  - "3.9"
  - "3.10"
  - "nightly"

matrix:
  allow_failures:
    - python: "3.10"
    - python: "nightly"

install:
  - pip install flit
  - flit install
  - flit build --setup-py

script:
  - pytest --cov-report=xml --cov=./meeple/

after_success:
  - codecov

deploy:
  # deploy develop branch to test pypi
  # - provider: pypi
  #   server: https://test.pypi.org/legacy/
  #   username: __token__
  #   password: $PYPI_TEST_TOKEN
  #   skip_cleanup: true
  #   skip_existing: true
  #   distributions: sdist bdist_wheel
  #   on:
  #     branch: staging
  #     python: "3.9"

  # deploy releases to pypi
  - provider: pypi
    username: __token__
    password: $PYPI_TOKEN
    skip_cleanup: true
    skip_existing: true
    distributions: sdist bdist_wheel
    on:
      tags: true
      python: "3.9"

  # deploy release tag docs to github pages
  # - provider: pages
  #   local_dir: docs
  #   skip_cleanup: true
  #   github_token: $GITHUB_TOKEN
  #   keep_history: true
  #   on:
  #     tags: true
  #     python: "3.9"
